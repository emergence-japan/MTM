<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="gameTitle">What Matters to Me</title>
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/survey.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
</head>

<body>

  <div id="language-switcher-container" style="position: absolute; top: 20px; right: 20px; z-index: 1000;"></div>

  <div id="participant-input-container"></div>

  <!-- Welcome Screen -->
  <section id="welcome" class="screen">
    <div class="content-wrapper">
      <h1 class="title" data-i18n="gameTitle">What Matters to Me</h1>

      <div id="welcome-message" style="margin-bottom: 1.5rem;">
        <!-- Participant name will be injected here -->
      </div>
      
      <button class="btn-primary" onclick="navigateTo('important-notes')" data-i18n="btnStart">
        ゲームを開始する
      </button>
    </div>
  </section>

  <!-- Important Notes (Intro) -->
  <section id="important-notes" class="screen">
    <div class="content-wrapper">
      <h2 data-i18n="introHeader">はじめに</h2>

      <div class="notes-box">
        <p data-i18n="introText1">このアクティビティでは、日常生活の中で自分にとって何が大切なのか、立ち止まって考えてみましょう。</p>
        <p data-i18n="introText2">テストや評価ではなく、あなたが何を大切にしているのか、なぜ大切にしているのかに気づく機会です。</p>
        <p data-i18n="introText3">時間をかけて、正直に答えてください。正解も不正解もありません。</p>
        
        <h3 data-i18n="remarksHeader" style="margin-top: 1.5rem;">備考</h3>
        <ul>
          <li data-i18n="remark1">所要時間の目安：約25～30分。</li>
          <li data-i18n="remark2">疲れたり、不快に感じたりした場合は、いつでも中断してかまいません。</li>
          <li data-i18n="remark3">あなたの回答は秘密であり、採点・評価されることはありません。</li>
          <li data-i18n="remark4">目的は自己理解と自覚であり、パフォーマンスではありません。</li>
        </ul>
      </div>

      <button class="btn-primary" onclick="navigateTo('step1')" data-i18n="btnUnderstand">
        理解して体験を開始する
      </button>
    </div>
  </section>

  <!-- Step 1 & 2: Listing and Ranking -->
  <section id="step1" class="screen">
    <div class="content-wrapper survey-wrapper">
        <h2 data-i18n="step1Title">ステップ1 & 2</h2>
        <p class="section-instruction" data-i18n="step1Instruction">あなたにとって大切なもの、人、出来事を5～6個ほど挙げてください。</p>
        
        <div id="item-list-container" class="item-list-container">
            <div class="item-input-group">
                <input type="text" class="text-input item-input" data-i18n-placeholder="itemPlaceholder" placeholder="大切なものを入力してください">
            </div>
            <div class="item-input-group">
                <input type="text" class="text-input item-input" data-i18n-placeholder="itemPlaceholder" placeholder="大切なものを入力してください">
            </div>
            <div class="item-input-group">
                <input type="text" class="text-input item-input" data-i18n-placeholder="itemPlaceholder" placeholder="大切なものを入力してください">
            </div>
            <div class="item-input-group">
                <input type="text" class="text-input item-input" data-i18n-placeholder="itemPlaceholder" placeholder="大切なものを入力してください">
            </div>
            <div class="item-input-group">
                <input type="text" class="text-input item-input" data-i18n-placeholder="itemPlaceholder" placeholder="大切なものを入力してください">
            </div>
            <div class="item-input-group">
                <input type="text" class="text-input item-input" data-i18n-placeholder="itemPlaceholder" placeholder="大切なものを入力してください">
            </div>
        </div>

        <div class="validation-panel" style="margin-top: 1rem;">
            <p id="item-count-status" class="validation-status invalid" data-i18n="validationMinItems">最低5つ入力してください</p>
        </div>

        <div id="ranking-container" style="display: none; margin-top: 2rem;">
            <h3 data-i18n="step2Title">重要度順に並び替える</h3>
            <p class="input-hint" data-i18n="step2Instruction">1 = 最も重要</p>
            <div id="ranked-items-list" class="ranked-items-list">
                <!-- Ranked items will be injected here -->
            </div>
        </div>

        <div class="form-actions">
            <button id="btn-to-ranking" class="btn-primary" onclick="showRanking()" disabled data-i18n="btnOrganize">次へ (整理)</button>
            <button id="btn-to-step3" class="btn-primary" onclick="navigateTo('step3')" style="display: none;" data-i18n="btnNext">次へ (深く考える)</button>
        </div>
    </div>
  </section>

  <!-- Step 3: Deep Thinking -->
  <section id="step3" class="screen">
    <div class="content-wrapper survey-wrapper">
        <h2 data-i18n="step3Title">ステップ3 - 深く考える</h2>
        <p class="section-instruction" data-i18n="step3Instruction">リストの上位項目について、さらに深く考えてみましょう。</p>
        
        <div id="deep-thinking-container">
            <!-- Reflection boxes will be injected here -->
        </div>

        <div class="form-actions">
            <button class="btn-primary" onclick="navigateTo('step4')" data-i18n="btnNext">次へ (まとめ)</button>
        </div>
    </div>
  </section>

  <!-- Step 4: Summary -->
  <section id="step4" class="screen">
    <div class="content-wrapper survey-wrapper">
        <h2 data-i18n="step4Title">ステップ4 - まとめ</h2>
        <p class="section-instruction" data-i18n="step4SummaryPrompt">この活動を通して、あなた自身について気づいたこと、再発見したことは何ですか？</p>
        
        <div class="question-group">
            <textarea id="final-summary" class="text-input" rows="6" style="width: 100%; max-width: 100%;" data-i18n-placeholder="summaryPlaceholder" placeholder="振り返りを記入してください..."></textarea>
        </div>

        <div class="form-actions">
            <button class="btn-primary" onclick="completeGameAndSend()" data-i18n="btnFinish">体験を完了する</button>
        </div>
    </div>
  </section>

  <!-- Completion Screen -->
  <section id="completion" class="screen">
    <div class="content-wrapper completion-content">
      <h1 class="completion-title" data-i18n="gameTitle">What Matters to Me</h1>

      <div class="completion-message">
        <p data-i18n="completionMsg1">この体験が、あなたの健康と幸福の支えとなり、より充実した人生を送る一助となることを願っています。</p>
        <p data-i18n="completionMsg2">本当にありがとうございました。</p>
      </div>

      <a href="index.html" class="btn-primary" style="margin-top: 2rem;" data-i18n="btnBackToTop">トップに戻る</a>

      <p class="copyright">©Hironori SAKAI 2025</p>
    </div>
  </section>

  <script src="js/participant.js"></script>
  <script src="js/input-form.js"></script>
  <script src="js/submit.js"></script>
  <script src="js/app.js"></script>
  <script src="js/i18n.js"></script>
  <script src="js/language-switcher.js"></script>
  
  <script>
    // Translations for Game Page
    const gameTranslations = {
      ja: {
        gameTitle: "What Matters to Me",
        btnStart: "ゲームを開始する",
        introHeader: "はじめに",
        introText1: "このアクティビティでは、日常生活の中で自分にとって何が大切なのか、立ち止まって考えてみましょう。",
        introText2: "テストや評価ではなく、あなたが何を大切にしているのか、なぜ大切にしているのかに気づく機会です。",
        introText3: "時間をかけて、正直に答えてください。正解も不正解もありません。",
        remarksHeader: "備考",
        remark1: "所要時間の目安：約25～30分。",
        remark2: "疲れたり、不快に感じたりした場合は、いつでも中断してかまいません。",
        remark3: "あなたの回答は秘密であり、採点・評価されることはありません。",
        remark4: "目的は自己理解と自覚であり、パフォーマンスではありません。",
        btnUnderstand: "理解して体験を開始する",
        step1Title: "ステップ1 & 2 - 整理",
        step1Instruction: "あなたにとって大切なもの、人、出来事を5～6個ほど挙げてください。",
        itemPlaceholder: "大切なものを入力してください",
        validationMinItems: "最低5つ入力してください",
        btnOrganize: "次へ (整理)",
        step2Title: "重要度順に並び替える",
        step2Instruction: "最も重要なものから順に番号を振ってください (1 = 最も重要)",
        btnNext: "次へ",
        step3Title: "ステップ3 - 深く考える",
        step3Instruction: "リストの上位項目について、さらに深く考えてみましょう。",
        whyImportant: "なぜそれがあなたにとって大切なのですか？",
        howInfluence: "これらのことは、あなたの気持ちや日常生活にどのような影響を与えていますか？",
        step4Title: "ステップ4 - まとめ",
        step4SummaryPrompt: "この活動を通して、あなた自身について気づいたこと、再発見したことは何ですか？",
        summaryPlaceholder: "振り返りを記入してください...",
        btnFinish: "体験を完了する",
        completionMsg1: "この体験が、あなたの健康と幸福の支えとなり、より充実した人生を送る一助となることを願っています。",
        completionMsg2: "本当にありがとうございました。",
        btnBackToTop: "トップに戻る",
        welcomeMsg: "ようこそ, {name} さん",
        formAnonymousCode: "匿名コード",
        formAnonymousCodeHelp: "後のアンケートで個人を特定するために使用します。半角英数字で入力してください。",
        formGender: "性別",
        formPleaseSelect: "選択してください",
        formMale: "男性",
        formFemale: "女性",
        formOther: "その他",
        formPreferNotToAnswer: "回答しない",
        formAge: "年齢",
        formYearsOld: "歳",
        formBtnSave: "入力内容を確定する"
      },
      en: {
        gameTitle: "What Matters to Me",
        btnStart: "Start Activity",
        introHeader: "Introduction",
        introText1: "This activity invites you to pause and reflect on what matters to you in daily life.",
        introText2: "It is not a test or evaluation, but an opportunity to notice what you value and why.",
        introText3: "Please take your time and answer honestly. There are no right or wrong answers.",
        remarksHeader: "Remarks",
        remark1: "Estimated time: 25-30 minutes.",
        remark2: "You may stop at any time if you feel tired or uncomfortable.",
        remark3: "Your answers are private and will not be graded or evaluated.",
        remark4: "The goal is self-understanding and awareness, not performance.",
        btnUnderstand: "I understand, start activity",
        step1Title: "Step 1 & 2 - Organizing",
        step1Instruction: "List about 5–6 things, people, or events that are important to you.",
        itemPlaceholder: "Enter something important",
        validationMinItems: "Please enter at least 5 items",
        btnOrganize: "Next (Organize)",
        step2Title: "Organize by Importance",
        step2Instruction: "Arrange these items from most important to least important (1 = most important).",
        btnNext: "Next",
        step3Title: "Step 3 - Deep Thinking",
        step3Instruction: "Reflect more deeply on the top items from your list.",
        whyImportant: "Why is this important to you?",
        howInfluence: "How does this influence your feelings or daily life?",
        step4Title: "Step 4 - Summary",
        step4SummaryPrompt: "What did you notice or rediscover about yourself during this activity?",
        summaryPlaceholder: "Enter your summary here...",
        btnFinish: "Finish Activity",
        completionMsg1: "We hope this experience supports your health and happiness and helps you lead a more fulfilling life.",
        completionMsg2: "Thank you very much.",
        btnBackToTop: "Back to Top",
        welcomeMsg: "Welcome, {name}",
        formAnonymousCode: "Anonymous Code",
        formAnonymousCodeHelp: "Used to identify you in later surveys. Please enter alphanumeric characters.",
        formGender: "Gender",
        formPleaseSelect: "Please select",
        formMale: "Male",
        formFemale: "Female",
        formOther: "Other",
        formPreferNotToAnswer: "Prefer not to answer",
        formAge: "Age",
        formYearsOld: "years old",
        formBtnSave: "Confirm and proceed"
      }
    };

    document.addEventListener('DOMContentLoaded', () => {
      window.i18n = new I18n(gameTranslations);
      const switcherContainer = document.getElementById('language-switcher-container');
      const switcher = new LanguageSwitcher(window.i18n, switcherContainer);
      switcher.render();
      window.i18n.updateDOM();

      const container = document.getElementById('participant-input-container');

      requireParticipantOrInput(container, () => {
        const participant = getParticipant();
        
        // ウェルカムメッセージの表示
        const welcomeMessageEl = document.getElementById('welcome-message');
        if (welcomeMessageEl) {
          const msg = i18n.t('welcomeMsg').replace('{name}', `<strong style="color: var(--color-primary);">${participant.anonymousCode}</strong>`);
          welcomeMessageEl.innerHTML = `<p class="subtitle" style="color: white;">${msg}</p>`;
        }
        
        // 最初の画面を表示
        document.getElementById('welcome').classList.add('active');
      });
    });
  </script>
</body>

</html>